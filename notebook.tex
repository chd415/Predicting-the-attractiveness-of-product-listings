
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{447final}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sns}
        \PY{k+kn}{import} \PY{n+nn}{re}
        \PY{k+kn}{import} \PY{n+nn}{sys}
        \PY{k+kn}{from} \PY{n+nn}{html}\PY{n+nn}{.}\PY{n+nn}{parser} \PY{k}{import} \PY{n}{HTMLParser}
        \PY{k+kn}{from} \PY{n+nn}{html}\PY{n+nn}{.}\PY{n+nn}{entities} \PY{k}{import} \PY{n}{name2codepoint}
        \PY{n}{sns}\PY{o}{.}\PY{n}{set}\PY{p}{(}\PY{n}{color\PYZus{}codes}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
        \PY{k+kn}{import} \PY{n+nn}{warnings}
        \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ignore}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}                   
        \PY{k+kn}{import} \PY{n+nn}{nltk}                                         
        \PY{n}{nltk}\PY{o}{.}\PY{n}{download}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stopwords}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{corpus} \PY{k}{import} \PY{n}{stopwords}                   
        \PY{k+kn}{from} \PY{n+nn}{nltk}\PY{n+nn}{.}\PY{n+nn}{stem} \PY{k}{import} \PY{n}{PorterStemmer}  
        \PY{n}{LA} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}
        
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k}{import} \PY{n}{CountVectorizer}          
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}extraction}\PY{n+nn}{.}\PY{n+nn}{text} \PY{k}{import} \PY{n}{TfidfVectorizer}    
        \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{preprocessing}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k}{import} \PY{n}{LabelEncoder}
        \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{pipeline} \PY{k}{import} \PY{n}{Pipeline}
        \PY{k+kn}{from} \PY{n+nn}{collections} \PY{k}{import} \PY{n}{defaultdict}
        \PY{k+kn}{from} \PY{n+nn}{gensim}\PY{n+nn}{.}\PY{n+nn}{models}\PY{n+nn}{.}\PY{n+nn}{word2vec} \PY{k}{import} \PY{n}{Word2Vec}                                  
        \PY{k+kn}{import} \PY{n+nn}{re}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
[nltk\_data] Downloading package stopwords to
[nltk\_data]     /Users/chd415/nltk\_data{\ldots}
[nltk\_data]   Package stopwords is already up-to-date!

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{c+c1}{\PYZsh{} load training data text}
        \PY{k}{def} \PY{n+nf}{load\PYZus{}data}\PY{p}{(}\PY{n}{filename}\PY{p}{)}\PY{p}{:}
            \PY{n}{load\PYZus{}file} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filename}\PY{p}{,}\PY{n}{delimiter}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{,}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{header}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}
                                \PY{n}{dtype}\PY{o}{=}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n+nb}{str}\PY{p}{\PYZcb{}}\PY{p}{)}
            \PY{n}{load\PYZus{}file}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{load\PYZus{}file}\PY{o}{.}\PY{n}{duplicated}\PY{p}{(}\PY{n}{subset}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{keep}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{first}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{load\PYZus{}file}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inplace} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
            \PY{n}{load\PYZus{}file}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
            \PY{k}{return} \PY{n}{load\PYZus{}file}
        \PY{c+c1}{\PYZsh{}print(len(train\PYZus{}file))}
        \PY{k}{def} \PY{n+nf}{load\PYZus{}label}\PY{p}{(}\PY{n}{filename}\PY{p}{)}\PY{p}{:}
            \PY{n}{load\PYZus{}label} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{n}{filename}\PY{p}{,}\PY{n}{delimiter}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{,}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{header}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
            \PY{n}{load\PYZus{}label}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{load\PYZus{}label}\PY{o}{.}\PY{n}{duplicated}\PY{p}{(}\PY{n}{subset}\PY{o}{=}\PY{k+kc}{None}\PY{p}{,} \PY{n}{keep}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{first}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
            \PY{n}{load\PYZus{}label}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{id}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{inplace} \PY{o}{=} \PY{k+kc}{True}\PY{p}{)}
            \PY{k}{return} \PY{n}{load\PYZus{}label}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{def map\PYZus{}mathod(column):}
        \PY{l+s+sd}{    values = []}
        \PY{l+s+sd}{    indexs = []}
        \PY{l+s+sd}{    mapping = \PYZob{}\PYZcb{}}
        \PY{l+s+sd}{    index = 0}
        \PY{l+s+sd}{    for count in range(len(train\PYZus{}file)):}
        \PY{l+s+sd}{        value = train\PYZus{}file.get\PYZus{}value(count+1,column)}
        \PY{l+s+sd}{        if value in values and value != np.nan:}
        \PY{l+s+sd}{            continue}
        \PY{l+s+sd}{        values.append(value)}
        \PY{l+s+sd}{        indexs.append(len(values))}
        \PY{l+s+sd}{    for j in range(len(indexs)):}
        \PY{l+s+sd}{        mapping[values[j]] = indexs[j]}
        \PY{l+s+sd}{    mapping[np.nan] = 0.0}
        \PY{l+s+sd}{    return mapping}
        \PY{l+s+sd}{\PYZsh{}train\PYZus{}file[\PYZsq{}lvl3\PYZsq{}] = train\PYZus{}file[\PYZsq{}lvl3\PYZsq{}].str.lower().replace(\PYZsq{}[\PYZca{}\PYZbs{}\PYZsq{}\PYZbs{}w]+\PYZsq{},\PYZsq{} \PYZsq{},regex=True)}
        \PY{l+s+sd}{\PYZsh{}mapping\PYZus{}lvl3 = map\PYZus{}mathod(\PYZsq{}lvl3\PYZsq{})}
        \PY{l+s+sd}{\PYZsh{}print(mapping\PYZus{}lvl3)}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        
        \PY{k}{class} \PY{n+nc}{MultiColumnLabelEncoder}\PY{p}{:}
            \PY{k}{def} \PY{n+nf}{\PYZus{}\PYZus{}init\PYZus{}\PYZus{}}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{columns} \PY{o}{=} \PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{n}{columns} \PY{c+c1}{\PYZsh{} array of column names to encode}
        
            \PY{k}{def} \PY{n+nf}{fit}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{X}\PY{p}{,}\PY{n}{y}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{k}{return} \PY{n+nb+bp}{self} \PY{c+c1}{\PYZsh{} not relevant here}
        
            \PY{k}{def} \PY{n+nf}{transform}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{X}\PY{p}{)}\PY{p}{:}
                \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{        Transforms columns of X specified in self.columns using}
        \PY{l+s+sd}{        LabelEncoder(). If no columns specified, transforms all}
        \PY{l+s+sd}{        columns in X.}
        \PY{l+s+sd}{        \PYZsq{}\PYZsq{}\PYZsq{}}
                \PY{n}{output} \PY{o}{=} \PY{n}{X}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
                \PY{k}{if} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{columns} \PY{o+ow}{is} \PY{o+ow}{not} \PY{k+kc}{None}\PY{p}{:}
                    \PY{k}{for} \PY{n}{col} \PY{o+ow}{in} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
                        \PY{n}{output}\PY{p}{[}\PY{n}{col}\PY{p}{]} \PY{o}{=} \PY{n}{LabelEncoder}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{output}\PY{p}{[}\PY{n}{col}\PY{p}{]}\PY{p}{)}
                \PY{k}{else}\PY{p}{:}
                    \PY{k}{for} \PY{n}{colname}\PY{p}{,}\PY{n}{col} \PY{o+ow}{in} \PY{n}{output}\PY{o}{.}\PY{n}{iteritems}\PY{p}{(}\PY{p}{)}\PY{p}{:}
                        \PY{n}{output}\PY{p}{[}\PY{n}{colname}\PY{p}{]} \PY{o}{=} \PY{n}{LabelEncoder}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{col}\PY{p}{)}
                \PY{k}{return} \PY{n}{output}
        
            \PY{k}{def} \PY{n+nf}{fit\PYZus{}transform}\PY{p}{(}\PY{n+nb+bp}{self}\PY{p}{,}\PY{n}{X}\PY{p}{,}\PY{n}{y}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{p}{:}
                \PY{k}{return} \PY{n+nb+bp}{self}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,}\PY{n}{y}\PY{p}{)}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{k}{def} \PY{n+nf}{text\PYZus{}embedding}\PY{p}{(}\PY{n}{column}\PY{p}{)}\PY{p}{:}
            \PY{n}{temp\PYZus{}X} \PY{o}{=} \PY{n}{column}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}
            \PY{n}{stop} \PY{o}{=} \PY{n+nb}{set}\PY{p}{(}\PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
            \PY{n}{temp} \PY{o}{=}\PY{p}{[}\PY{p}{]}
            \PY{n}{snow} \PY{o}{=} \PY{n}{nltk}\PY{o}{.}\PY{n}{stem}\PY{o}{.}\PY{n}{SnowballStemmer}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
            \PY{k}{for} \PY{n}{sentence} \PY{o+ow}{in} \PY{n}{temp\PYZus{}X}\PY{p}{:} 
                \PY{n}{words} \PY{o}{=} \PY{p}{[}\PY{n}{snow}\PY{o}{.}\PY{n}{stem}\PY{p}{(}\PY{n}{word}\PY{p}{)} \PY{k}{for} \PY{n}{word} \PY{o+ow}{in} \PY{n}{sentence}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} \PY{k}{if} \PY{n}{word} \PY{o+ow}{not} \PY{o+ow}{in} \PY{n}{stopwords}\PY{o}{.}\PY{n}{words}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{english}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{]}   \PY{c+c1}{\PYZsh{} Stemming and removing stopwords}
                \PY{n}{temp}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{sentence}\PY{p}{)}
        
            \PY{n}{count\PYZus{}vect} \PY{o}{=} \PY{n}{CountVectorizer}\PY{p}{(}\PY{n}{max\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{10000}\PY{p}{)}
            \PY{n}{bow\PYZus{}data} \PY{o}{=} \PY{n}{count\PYZus{}vect}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{temp}\PY{p}{)}
        
            \PY{n}{final\PYZus{}tf} \PY{o}{=} \PY{n}{temp}
            \PY{n}{tf\PYZus{}idf} \PY{o}{=} \PY{n}{TfidfVectorizer}\PY{p}{(}\PY{n}{max\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{10000}\PY{p}{)}
            \PY{n}{tf\PYZus{}data} \PY{o}{=} \PY{n}{tf\PYZus{}idf}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{final\PYZus{}tf}\PY{p}{)}
            \PY{n}{w2v\PYZus{}data} \PY{o}{=} \PY{n}{temp}
            \PY{n}{splitted} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{row} \PY{o+ow}{in} \PY{n}{w2v\PYZus{}data}\PY{p}{:} 
                \PY{n}{splitted}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{[}\PY{n}{word} \PY{k}{for} \PY{n}{word} \PY{o+ow}{in} \PY{n}{row}\PY{o}{.}\PY{n}{split}\PY{p}{(}\PY{p}{)}\PY{p}{]}\PY{p}{)}     \PY{c+c1}{\PYZsh{}splitting words}
            
            \PY{n}{train\PYZus{}w2v} \PY{o}{=} \PY{n}{Word2Vec}\PY{p}{(}\PY{n}{splitted}\PY{p}{,}\PY{n}{min\PYZus{}count}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{size}\PY{o}{=}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{workers}\PY{o}{=}\PY{l+m+mi}{4}\PY{p}{)}
            \PY{n}{avg\PYZus{}data} \PY{o}{=} \PY{p}{[}\PY{p}{]}
            \PY{k}{for} \PY{n}{row} \PY{o+ow}{in} \PY{n}{splitted}\PY{p}{:}
                \PY{n}{vec} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{n+nb}{float}\PY{p}{)}
                \PY{n}{count} \PY{o}{=} \PY{l+m+mi}{0}
                \PY{k}{for} \PY{n}{word} \PY{o+ow}{in} \PY{n}{row}\PY{p}{:}
                    \PY{k}{try}\PY{p}{:}
                        \PY{n}{vec} \PY{o}{+}\PY{o}{=} \PY{n}{train\PYZus{}w2v}\PY{p}{[}\PY{n}{word}\PY{p}{]}
                        \PY{n}{count} \PY{o}{+}\PY{o}{=} \PY{l+m+mi}{1}
                    \PY{k}{except}\PY{p}{:}
                        \PY{k}{pass}
                \PY{k}{if} \PY{p}{(}\PY{n}{count} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:}
                    \PY{n}{avg\PYZus{}data}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{vec}\PY{p}{)}
                \PY{k}{else}\PY{p}{:}
                    \PY{n}{avg\PYZus{}data}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{vec}\PY{o}{/}\PY{n}{count}\PY{p}{)}
        \PY{c+c1}{\PYZsh{}        avg\PYZus{}data.append(vec)}
            
            \PY{k}{return} \PY{n}{avg\PYZus{}data}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{\PYZsh{}test cell}
        \PY{l+s+sd}{temp = load\PYZus{}data(\PYZsq{}train\PYZus{}data.csv\PYZsq{})}
        \PY{l+s+sd}{temp[\PYZsq{}descrption\PYZsq{}] = temp[\PYZsq{}descrption\PYZsq{}].str.lower()}
        \PY{l+s+sd}{description\PYZus{}X = temp.descrption.str.lower().replace(\PYZsq{}\PYZlt{}.*?\PYZgt{}\PYZsq{},\PYZsq{}\PYZsq{},regex=True).replace(\PYZsq{}[\PYZca{}\PYZbs{}w\PYZbs{}s]+\PYZsq{},\PYZsq{} \PYZsq{},regex=True)}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{\PYZsh{}test cell}
        \PY{l+s+sd}{def test\PYZus{}embedding(column):}
        \PY{l+s+sd}{    temp\PYZus{}X = column.astype(str)}
        \PY{l+s+sd}{    stop = set(stopwords.words(\PYZsq{}english\PYZsq{}))}
        \PY{l+s+sd}{    temp =[]}
        \PY{l+s+sd}{    snow = nltk.stem.SnowballStemmer(\PYZsq{}english\PYZsq{})}
        
        \PY{l+s+sd}{    for sentence in temp\PYZus{}X: }
        \PY{l+s+sd}{        words = [snow.stem(word) for word in sentence.split(\PYZsq{} \PYZsq{}) if word not in stopwords.words(\PYZsq{}english\PYZsq{})]   \PYZsh{} Stemming and removing stopwords}
        \PY{l+s+sd}{        temp.append(sentence)}
        
        \PY{l+s+sd}{    count\PYZus{}vect = CountVectorizer(max\PYZus{}features=5000)}
        \PY{l+s+sd}{    bow\PYZus{}data = count\PYZus{}vect.fit\PYZus{}transform(temp)}
        
        \PY{l+s+sd}{    final\PYZus{}tf = temp}
        \PY{l+s+sd}{    tf\PYZus{}idf = TfidfVectorizer(ngram\PYZus{}range=(1,2),stop\PYZus{}words = \PYZsq{}english\PYZsq{},max\PYZus{}features=5000)}
        \PY{l+s+sd}{    tf\PYZus{}data = tf\PYZus{}idf.fit\PYZus{}transform(final\PYZus{}tf)}
        \PY{l+s+sd}{    w2v\PYZus{}data = temp}
        \PY{l+s+sd}{    splitted = []}
        \PY{l+s+sd}{    for row in w2v\PYZus{}data: }
        \PY{l+s+sd}{        splitted.append([word for word in row.split()])     \PYZsh{}splitting words}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    train\PYZus{}w2v = Word2Vec(splitted,min\PYZus{}count=5,size=50, workers=4)}
        \PY{l+s+sd}{    avg\PYZus{}data = []}
        \PY{l+s+sd}{    for row in splitted:}
        \PY{l+s+sd}{        vec = np.zeros(50, dtype=float)}
        \PY{l+s+sd}{        count = 0}
        \PY{l+s+sd}{        for word in row:}
        \PY{l+s+sd}{            try:}
        \PY{l+s+sd}{                vec += train\PYZus{}w2v[word]}
        \PY{l+s+sd}{                count += 1}
        \PY{l+s+sd}{            except:}
        \PY{l+s+sd}{                pass}
        \PY{l+s+sd}{        if (count == 0):}
        \PY{l+s+sd}{            avg\PYZus{}data.append(vec)}
        \PY{l+s+sd}{        else:}
        \PY{l+s+sd}{            avg\PYZus{}data.append(vec/count)}
        \PY{l+s+sd}{\PYZsh{}        avg\PYZus{}data.append(vec)}
        
        \PY{l+s+sd}{    tf\PYZus{}w\PYZus{}data = []}
        \PY{l+s+sd}{    tf\PYZus{}data = tf\PYZus{}data.toarray()}
        \PY{l+s+sd}{    i = 0}
        \PY{l+s+sd}{    for row in splitted:}
        \PY{l+s+sd}{        vec = [0 for i in range(50)]}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{        temp\PYZus{}tfidf = []}
        \PY{l+s+sd}{        for val in tf\PYZus{}data[i]:}
        \PY{l+s+sd}{            if val != 0:}
        \PY{l+s+sd}{                temp\PYZus{}tfidf.append(val)}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{        count = 0}
        \PY{l+s+sd}{        tf\PYZus{}idf\PYZus{}sum = 0}
        \PY{l+s+sd}{        for word in row:}
        \PY{l+s+sd}{            try:}
        \PY{l+s+sd}{                count += 1}
        \PY{l+s+sd}{                tf\PYZus{}idf\PYZus{}sum = tf\PYZus{}idf\PYZus{}sum + temp\PYZus{}tfidf[count\PYZhy{}1]}
        \PY{l+s+sd}{                vec += (temp\PYZus{}tfidf[count\PYZhy{}1] * train\PYZus{}w2v[word])}
        \PY{l+s+sd}{            except:}
        \PY{l+s+sd}{                pass}
        \PY{l+s+sd}{        if (tf\PYZus{}idf\PYZus{}sum == 0):}
        \PY{l+s+sd}{            tf\PYZus{}w\PYZus{}data.append(vec)}
        \PY{l+s+sd}{        else:}
        \PY{l+s+sd}{            tf\PYZus{}w\PYZus{}data.append(vec/tf\PYZus{}idf\PYZus{}sum)}
        \PY{l+s+sd}{\PYZsh{}            vec = float(1/tf\PYZus{}idf\PYZus{}sum) * vec}
        \PY{l+s+sd}{\PYZsh{}        tf\PYZus{}w\PYZus{}data.append(vec)}
        \PY{l+s+sd}{        i = i + 1}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    return tf\PYZus{}w\PYZus{}data}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{\PYZsh{}test cell}
        \PY{l+s+sd}{from sklearn.feature\PYZus{}extraction.text import CountVectorizer}
        \PY{l+s+sd}{from sklearn.feature\PYZus{}extraction.text import TfidfVectorizer}
        
        \PY{l+s+sd}{temp[\PYZsq{}descrption\PYZsq{}] = test\PYZus{}embedding(description\PYZus{}X)}
        \PY{l+s+sd}{temp.descrption.head()}
        \PY{l+s+sd}{\PYZsh{}tfidf\PYZus{}n = TfidfVectorizer(ngram\PYZus{}range=(1,2),stop\PYZus{}words = \PYZsq{}english\PYZsq{})}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{k}{def} \PY{n+nf}{clean\PYZus{}data}\PY{p}{(}\PY{n}{filename}\PY{p}{)}\PY{p}{:}
            
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}a\PYZhy{}zA\PYZhy{}Z]+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}}\PY{l+s+se}{\PYZbs{}\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{w]+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}}\PY{l+s+se}{\PYZbs{}\PYZsq{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{w]+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}
        
            \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    mapping\PYZus{}lvl1 = map\PYZus{}mathod(\PYZsq{}lvl1\PYZsq{})}
        \PY{l+s+sd}{    mapping\PYZus{}lvl2 = map\PYZus{}mathod(\PYZsq{}lvl2\PYZsq{})}
        \PY{l+s+sd}{    mapping\PYZus{}lvl3 = map\PYZus{}mathod(\PYZsq{}lvl3\PYZsq{})}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    filename[\PYZsq{}lvl1\PYZsq{}] = filename[\PYZsq{}lvl1\PYZsq{}].map(mapping\PYZus{}lvl1)}
        \PY{l+s+sd}{    filename[\PYZsq{}lvl2\PYZsq{}] = filename[\PYZsq{}lvl2\PYZsq{}].map(mapping\PYZus{}lvl2)}
        \PY{l+s+sd}{    filename[\PYZsq{}lvl3\PYZsq{}] = filename[\PYZsq{}lvl3\PYZsq{}].map(mapping\PYZus{}lvl3)}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    \PYZsq{}\PYZsq{}\PYZsq{}}
            \PY{c+c1}{\PYZsh{}clean up data for lvl 1\PYZam{}2\PYZam{}3}
            \PY{n}{temp} \PY{o}{=}  \PY{n}{filename}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{MultiColumnLabelEncoder}\PY{p}{(}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{fit\PYZus{}transform}\PY{p}{(}\PY{n}{temp}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{str}\PY{p}{)}\PY{p}{)}
            \PY{n}{enc} \PY{o}{=} \PY{n}{preprocessing}\PY{o}{.}\PY{n}{OneHotEncoder}\PY{p}{(}\PY{p}{)}
            \PY{n}{enc}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{outfile}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{enc}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{outfile}\PY{p}{)}\PY{o}{.}\PY{n}{toarray}\PY{p}{(}\PY{p}{)}
            
            \PY{c+c1}{\PYZsh{}normalize price}
            \PY{n}{maxp} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{price}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
            \PY{n}{valuethred} \PY{o}{=} \PY{l+m+mf}{1000.}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{clip}\PY{p}{(}\PY{n}{lower}\PY{o}{=}\PY{l+m+mf}{0.}\PY{p}{,}\PY{n}{upper}\PY{o}{=}\PY{n}{valuethred}\PY{p}{)}
            \PY{c+c1}{\PYZsh{}filename[\PYZsq{}price\PYZsq{}] = filename[\PYZsq{}price\PYZsq{}].clip(lower=0.,upper=valuethred).div(valuethred,fill\PYZus{}value=None)}
            \PY{c+c1}{\PYZsh{}hist = train\PYZus{}file[\PYZsq{}price\PYZsq{}].hist(bins=10)}
            \PY{c+c1}{\PYZsh{}maxp}
            \PY{n}{ld} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{price}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{column\PYZus{}stack}\PY{p}{(}\PY{p}{(}\PY{n}{outfile}\PY{p}{,}\PY{n}{ld}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{}clean up type }
            \PY{n}{mapping\PYZus{}type} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{international}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mf}{1.}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{local}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{l+m+mf}{2.}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{nan}\PY{p}{:}\PY{l+m+mf}{0.}\PY{p}{\PYZcb{}}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{map}\PY{p}{(}\PY{n}{mapping\PYZus{}type}\PY{p}{)}
            \PY{n}{le} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{type}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{column\PYZus{}stack}\PY{p}{(}\PY{p}{(}\PY{n}{outfile}\PY{p}{,}\PY{n}{le}\PY{p}{)}\PY{p}{)}
        
            \PY{c+c1}{\PYZsh{}clean up text}
            \PY{n}{description\PYZus{}X} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{descrption}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}li\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}.*?\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{w}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{s]+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{count\PYZus{}descrption} \PY{o}{=} \PY{n}{description\PYZus{}X}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{count}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{column\PYZus{}stack}\PY{p}{(}\PY{p}{(}\PY{n}{outfile}\PY{p}{,}\PY{n}{count\PYZus{}descrption}\PY{p}{)}\PY{p}{)}
            
            \PY{n}{description\PYZus{}X} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{descrption}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{final }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{descrption}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{text\PYZus{}embedding}\PY{p}{(}\PY{n}{description\PYZus{}X}\PY{p}{)}
         
            \PY{n}{lg} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{descrption}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            \PY{n}{lg\PYZus{}array} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(} \PY{n}{lg} \PY{p}{)}
        
            \PY{n}{U}\PY{p}{,} \PY{n}{s}\PY{p}{,} \PY{n}{Vh} \PY{o}{=} \PY{n}{LA}\PY{o}{.}\PY{n}{svd}\PY{p}{(}\PY{n}{lg\PYZus{}array}\PY{p}{,} \PY{n}{full\PYZus{}matrices}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{k}{assert} \PY{n}{np}\PY{o}{.}\PY{n}{allclose}\PY{p}{(}\PY{n}{lg\PYZus{}array}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{U}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{diag}\PY{p}{(}\PY{n}{s}\PY{p}{)}\PY{p}{,} \PY{n}{Vh}\PY{p}{)}\PY{p}{)}\PY{p}{)}
            \PY{n}{s\PYZus{}new} \PY{o}{=} \PY{n}{s}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{8}\PY{p}{]}
            \PY{n}{U\PYZus{}new} \PY{o}{=} \PY{n}{U}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{8}\PY{p}{]}
            \PY{n}{new\PYZus{}lg} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{U\PYZus{}new}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{diag}\PY{p}{(}\PY{n}{s\PYZus{}new}\PY{p}{)}\PY{p}{)}
            \PY{n}{lg\PYZus{}min} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{new\PYZus{}lg}\PY{p}{)}
            \PY{n}{lg\PYZus{}out} \PY{o}{=} \PY{n}{new\PYZus{}lg}  \PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{lg\PYZus{}min}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{new\PYZus{}lg}\PY{o}{.}\PY{n}{size}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{column\PYZus{}stack}\PY{p}{(}\PY{p}{(}\PY{n}{outfile}\PY{p}{,}\PY{n}{lg\PYZus{}out}\PY{p}{)}\PY{p}{)}
            
            
            \PY{n}{name\PYZus{}X} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{name}\PY{o}{.}\PY{n}{str}\PY{o}{.}\PY{n}{lower}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZlt{}.*?\PYZgt{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}\PY{o}{.}\PY{n}{replace}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{[\PYZca{}}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{w}\PY{l+s+s1}{\PYZbs{}}\PY{l+s+s1}{s]+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{regex}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
            \PY{n}{filename}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{name}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{text\PYZus{}embedding}\PY{p}{(}\PY{n}{name\PYZus{}X}\PY{p}{)}
            
            \PY{n}{lf} \PY{o}{=} \PY{n}{filename}\PY{o}{.}\PY{n}{name}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
            \PY{n}{lf\PYZus{}array} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{vstack}\PY{p}{(} \PY{n}{lf} \PY{p}{)}
        
            \PY{n}{Uf}\PY{p}{,} \PY{n}{sf}\PY{p}{,} \PY{n}{Vhf} \PY{o}{=} \PY{n}{LA}\PY{o}{.}\PY{n}{svd}\PY{p}{(}\PY{n}{lf\PYZus{}array}\PY{p}{,} \PY{n}{full\PYZus{}matrices}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
            \PY{k}{assert} \PY{n}{np}\PY{o}{.}\PY{n}{allclose}\PY{p}{(}\PY{n}{lf\PYZus{}array}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{Uf}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{diag}\PY{p}{(}\PY{n}{sf}\PY{p}{)}\PY{p}{,} \PY{n}{Vhf}\PY{p}{)}\PY{p}{)}\PY{p}{)}
            \PY{n}{sf\PYZus{}new} \PY{o}{=} \PY{n}{sf}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{8}\PY{p}{]}
            \PY{n}{Uf\PYZus{}new} \PY{o}{=} \PY{n}{Uf}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{l+m+mi}{8}\PY{p}{]}
            \PY{n}{new\PYZus{}lf} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{Uf\PYZus{}new}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{diag}\PY{p}{(}\PY{n}{sf\PYZus{}new}\PY{p}{)}\PY{p}{)}
            \PY{n}{lf\PYZus{}min} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{n}{new\PYZus{}lf}\PY{p}{)}
            \PY{n}{lf\PYZus{}out} \PY{o}{=} \PY{n}{new\PYZus{}lf}  \PY{o}{\PYZhy{}} \PY{p}{(}\PY{n}{lf\PYZus{}min}\PY{o}{\PYZhy{}}\PY{l+m+mi}{2}\PY{p}{)}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{ones\PYZus{}like}\PY{p}{(}\PY{n}{new\PYZus{}lf}\PY{o}{.}\PY{n}{size}\PY{p}{)}
            \PY{n}{outfile} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{column\PYZus{}stack}\PY{p}{(}\PY{p}{(}\PY{n}{outfile}\PY{p}{,}\PY{n}{lf\PYZus{}out}\PY{p}{)}\PY{p}{)}
           
        
            \PY{k}{return} \PY{n}{outfile}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{train\PYZus{}file = pd.read\PYZus{}csv(\PYZsq{}train\PYZus{}data.csv\PYZsq{},delimiter=\PYZsq{},\PYZsq{}, header=0, nrows=10)}
        \PY{l+s+sd}{train\PYZus{}file.columns = [\PYZsq{}id\PYZsq{}, \PYZsq{}name\PYZsq{},\PYZsq{}lvl1\PYZsq{},\PYZsq{}lvl2\PYZsq{},\PYZsq{}lvl3\PYZsq{},\PYZsq{}descrption\PYZsq{},\PYZsq{}price\PYZsq{},\PYZsq{}type\PYZsq{}]}
        \PY{l+s+sd}{description\PYZus{}X = train\PYZus{}file.descrption.str.lower().replace(\PYZsq{}\PYZlt{}li\PYZgt{}\PYZsq{},\PYZsq{}final \PYZsq{},regex=True).replace(\PYZsq{}\PYZlt{}.*?\PYZgt{}\PYZsq{},\PYZsq{}\PYZsq{},regex=True).replace(\PYZsq{}[\PYZca{}\PYZbs{}w\PYZbs{}s]+\PYZsq{},\PYZsq{} \PYZsq{},regex=True)}
        \PY{l+s+sd}{count\PYZus{}descrption = description\PYZus{}X.str.count(\PYZsq{}final\PYZsq{})}
        \PY{l+s+sd}{description\PYZus{}X = train\PYZus{}file.descrption.str.lower().replace(\PYZsq{}final \PYZsq{},\PYZsq{}\PYZsq{},regex=True)}
        \PY{l+s+sd}{print(np.shape(count\PYZus{}descrption))}
        
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{train\PYZus{}file} \PY{o}{=} \PY{n}{load\PYZus{}data}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{test\PYZus{}file} \PY{o}{=} \PY{n}{load\PYZus{}data}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test\PYZus{}data.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{combined\PYZus{}file} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{concat}\PY{p}{(}\PY{p}{[}\PY{n}{train\PYZus{}file}\PY{p}{,}\PY{n}{test\PYZus{}file}\PY{p}{]}\PY{p}{)}
        \PY{n}{cleaned\PYZus{}train} \PY{o}{=} \PY{n}{clean\PYZus{}data}\PY{p}{(}\PY{n}{combined\PYZus{}file}\PY{p}{)}
        \PY{n}{train\PYZus{}score} \PY{o}{=} \PY{n}{load\PYZus{}label}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train\PYZus{}label.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{cleaned\PYZus{}train}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}6}]:} (36283, 270)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        \PY{l+s+sd}{\PYZsh{} test cell}
        \PY{l+s+sd}{cleaned\PYZus{}train[\PYZsq{}descrption\PYZsq{}] = temp[\PYZsq{}descrption\PYZsq{}]}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{cleaned\PYZus{}train}
        \PY{c+c1}{\PYZsh{}print(mapping\PYZus{}lvl1)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}7}]:} array([[ 0.        ,  0.        ,  0.        , {\ldots}, 10.13324131,
                11.99554897, 11.35688418],
               [ 0.        ,  1.        ,  0.        , {\ldots}, 11.9036486 ,
                 9.82575646, 10.58128699],
               [ 0.        ,  0.        ,  0.        , {\ldots}, 11.73378475,
                11.62101979, 11.51830028],
               {\ldots},
               [ 0.        ,  0.        ,  0.        , {\ldots}, 12.33374908,
                11.35996205, 11.5136934 ],
               [ 0.        ,  0.        ,  0.        , {\ldots}, 11.17770531,
                11.97945511, 11.61931454],
               [ 0.        ,  0.        ,  0.        , {\ldots}, 10.76861269,
                11.21852384, 11.04587675]])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
        
        \PY{l+s+sd}{def rearrange(cleaned\PYZus{}data):}
        \PY{l+s+sd}{    la = cleaned\PYZus{}data.lvl1.as\PYZus{}matrix(columns=None).tolist()}
        \PY{l+s+sd}{    lb = cleaned\PYZus{}data.lvl2.as\PYZus{}matrix(columns=None).tolist()}
        \PY{l+s+sd}{    lc = cleaned\PYZus{}data.lvl3.as\PYZus{}matrix(columns=None).tolist()}
        
        \PY{l+s+sd}{    X = la}
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,lb))}
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,lc))}
        
        \PY{l+s+sd}{    enc = preprocessing.OneHotEncoder()}
        \PY{l+s+sd}{    enc.fit(X)}
        \PY{l+s+sd}{    X = enc.transform(X).toarray()}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    ld = cleaned\PYZus{}data.price.as\PYZus{}matrix(columns=None).tolist()}
        \PY{l+s+sd}{    le = cleaned\PYZus{}data.type.as\PYZus{}matrix(columns=None).tolist()}
        
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,ld))}
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,le))}
        
        \PY{l+s+sd}{   }
        \PY{l+s+sd}{    lf = cleaned\PYZus{}data.name.as\PYZus{}matrix(columns=None).tolist()}
        \PY{l+s+sd}{    lg = cleaned\PYZus{}data.descrption.as\PYZus{}matrix(columns=None).tolist()}
        \PY{l+s+sd}{    lg\PYZus{}array = np.vstack( lg )}
        \PY{l+s+sd}{    lf\PYZus{}array = np.vstack( lf )}
        
        \PY{l+s+sd}{    U, s, Vh = LA.svd(lg\PYZus{}array, full\PYZus{}matrices=False)}
        \PY{l+s+sd}{    assert np.allclose(lg\PYZus{}array, np.dot(U, np.dot(np.diag(s), Vh)))}
        
        \PY{l+s+sd}{\PYZsh{} only use U \PYZbs{}cdot s}
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{\PYZsh{}    s[8:] = 0.}
        \PY{l+s+sd}{\PYZsh{}    new\PYZus{}lg = np.dot(U, np.dot(np.diag(s), Vh))}
        \PY{l+s+sd}{    s\PYZus{}new = s[:5]}
        \PY{l+s+sd}{    U\PYZus{}new = U[:, :5]}
        \PY{l+s+sd}{    new\PYZus{}lg = np.dot(U\PYZus{}new, np.diag(s\PYZus{}new))}
        \PY{l+s+sd}{    lg\PYZus{}min = np.min(new\PYZus{}lg)}
        \PY{l+s+sd}{    lg\PYZus{}out = new\PYZus{}lg  \PYZhy{} (lg\PYZus{}min\PYZhy{}2)*np.ones\PYZus{}like(new\PYZus{}lg.size)}
        
        \PY{l+s+sd}{    Uf, sf, Vhf = LA.svd(lf\PYZus{}array, full\PYZus{}matrices=False)}
        \PY{l+s+sd}{    assert np.allclose(lf\PYZus{}array, np.dot(Uf, np.dot(np.diag(sf), Vhf)))}
        
        \PY{l+s+sd}{\PYZsh{}    sf[5:] = 0.}
        \PY{l+s+sd}{\PYZsh{}    new\PYZus{}lf = np.dot(Uf, np.dot(np.diag(sf), Vhf))}
        \PY{l+s+sd}{    sf\PYZus{}new = sf[:5]}
        \PY{l+s+sd}{    Uf\PYZus{}new = Uf[:, :5]}
        \PY{l+s+sd}{    new\PYZus{}lf = np.dot(Uf\PYZus{}new, np.diag(sf\PYZus{}new))}
        \PY{l+s+sd}{    lf\PYZus{}min = np.min(new\PYZus{}lf)}
        \PY{l+s+sd}{    lf\PYZus{}out = new\PYZus{}lf  \PYZhy{} (lf\PYZus{}min\PYZhy{}2)*np.ones\PYZus{}like(new\PYZus{}lf.size)}
        
        \PY{l+s+sd}{    }
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,lf\PYZus{}out))}
        \PY{l+s+sd}{    X = np.column\PYZus{}stack((X,lg\PYZus{}out))}
        \PY{l+s+sd}{    X = X.tolist()}
        \PY{l+s+sd}{   }
        \PY{l+s+sd}{    return X,lf\PYZus{}min,lg\PYZus{}min}
        \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
            
            \PY{c+c1}{\PYZsh{}print(len(X))}
        \PY{n}{X} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{c+c1}{\PYZsh{}rearrange(cleaned\PYZus{}train)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{)}\PY{p}{)}
        \PY{n}{Y} \PY{o}{=} \PY{n}{train\PYZus{}score}\PY{o}{.}\PY{n}{score}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
        \PY{n}{X}\PY{p}{[}\PY{l+m+mi}{137}\PY{p}{,}\PY{l+m+mi}{253}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
(36283, 270)

    \end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}8}]:} 0.0
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{X} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{18141}\PY{p}{]}
        \PY{n}{XX} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{18141}\PY{p}{:}\PY{p}{]}
        \PY{n}{Y} \PY{o}{=} \PY{n}{train\PYZus{}score}\PY{o}{.}\PY{n}{score}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{Y}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{X}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{shape}\PY{p}{(}\PY{n}{XX}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
18141
(18141, 270)
(18142, 270)

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{utils} \PY{k}{import} \PY{n}{shuffle}
         \PY{n}{X}\PY{p}{,} \PY{n}{Y} \PY{o}{=} \PY{n}{shuffle}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{)}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{train\PYZus{}test\PYZus{}split}
         \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{X\PYZus{}validation}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}validation} \PY{o}{=} \PY{n}{train\PYZus{}test\PYZus{}split}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{,} \PY{n}{test\PYZus{}size}\PY{o}{=}\PY{l+m+mf}{0.20}\PY{p}{,} \PY{n}{random\PYZus{}state}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k}{import} \PY{n}{sequence}
         \PY{n}{maxlen} \PY{o}{=} \PY{l+m+mi}{270}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{X\PYZus{}validation} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float32}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}X\PYZus{}train = np.any(np.isnan(X\PYZus{}train))}
         \PY{c+c1}{\PYZsh{}X\PYZus{}train = np.all(np.isfinite(X\PYZus{}train))}
         \PY{n+nb}{print}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{1400}\PY{p}{]}\PY{o}{.}\PY{n}{size}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Using TensorFlow backend.

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
270

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{k+kn}{import} \PY{n+nn}{os}
         \PY{k+kn}{import} \PY{n+nn}{time}
         \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{metrics}
         \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{preprocessing}
         \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
         \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
         \PY{k+kn}{import} \PY{n+nn}{random}
         \PY{k+kn}{import} \PY{n+nn}{math}
         \PY{k+kn}{import} \PY{n+nn}{warnings}
         \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ignore}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
         
         \PY{k+kn}{from} \PY{n+nn}{matplotlib} \PY{k}{import} \PY{n}{pyplot} \PY{k}{as} \PY{n}{plt}
         
         \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{preprocessing}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{ExtraTreesClassifier}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}selection} \PY{k}{import} \PY{n}{SelectFromModel}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}selection} \PY{k}{import} \PY{n}{SelectPercentile}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{feature\PYZus{}selection} \PY{k}{import} \PY{n}{chi2}
         
         \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{linear\PYZus{}model}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{naive\PYZus{}bayes} \PY{k}{import} \PY{n}{MultinomialNB}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{neighbors} \PY{k}{import} \PY{n}{KNeighborsClassifier}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{linear\PYZus{}model} \PY{k}{import} \PY{n}{LogisticRegression}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{RandomForestClassifier}
         \PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k}{import} \PY{n}{tree}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{GradientBoostingClassifier}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{svm} \PY{k}{import} \PY{n}{SVC}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{grid\PYZus{}search} \PY{k}{import} \PY{n}{GridSearchCV}
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{GradientBoostingClassifier}
         
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{ensemble} \PY{k}{import} \PY{n}{BaggingClassifier}
         
         \PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{model\PYZus{}selection} \PY{k}{import} \PY{n}{cross\PYZus{}val\PYZus{}score}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{c+c1}{\PYZsh{} Linear Regression Classifier}
         \PY{k}{def} \PY{n+nf}{linear\PYZus{}regression\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{linear\PYZus{}model}\PY{o}{.}\PY{n}{LinearRegression}\PY{p}{(}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
          
         \PY{c+c1}{\PYZsh{} Multinomial Naive Bayes Classifier}
         \PY{k}{def} \PY{n+nf}{naive\PYZus{}bayes\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{MultinomialNB}\PY{p}{(}\PY{p}{)}
         
             \PY{n}{param\PYZus{}grid} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{n}{math}\PY{o}{.}\PY{n}{pow}\PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{n}{i}\PY{p}{)} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{11}\PY{p}{)}\PY{p}{]}\PY{p}{\PYZcb{}}
             \PY{n}{grid\PYZus{}search} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{param\PYZus{}grid}\PY{p}{,} \PY{n}{n\PYZus{}jobs} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{n}{best\PYZus{}parameters} \PY{o}{=} \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{best\PYZus{}estimator\PYZus{}}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{MultinomialNB}\PY{p}{(}\PY{n}{alpha} \PY{o}{=} \PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}  
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
          
          
         \PY{c+c1}{\PYZsh{} KNN Classifier}
         \PY{k}{def} \PY{n+nf}{knn\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{p}{)}
         
             \PY{n}{param\PYZus{}grid} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}neighbors}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{21}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
             \PY{n}{grid\PYZus{}search} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{param\PYZus{}grid}\PY{p}{,} \PY{n}{n\PYZus{}jobs} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{n}{best\PYZus{}parameters} \PY{o}{=} \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{best\PYZus{}estimator\PYZus{}}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{KNeighborsClassifier}\PY{p}{(}\PY{n}{n\PYZus{}neighbors} \PY{o}{=} \PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}neighbors}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{algorithm}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{kd\PYZus{}tree}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
             \PY{n}{bagging} \PY{o}{=} \PY{n}{BaggingClassifier}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{max\PYZus{}samples}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{max\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{1} \PY{p}{)}
             \PY{n}{bagging}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{bagging}
          
          
         \PY{c+c1}{\PYZsh{} Logistic Regression Classifier}
         \PY{k}{def} \PY{n+nf}{logistic\PYZus{}regression\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{LogisticRegression}\PY{p}{(}\PY{n}{penalty}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{l2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
          
          
         \PY{c+c1}{\PYZsh{} Random Forest Classifier}
         \PY{k}{def} \PY{n+nf}{random\PYZus{}forest\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{p}{)}
         
             \PY{n}{param\PYZus{}grid} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}estimators}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{21}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
             \PY{n}{grid\PYZus{}search} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{param\PYZus{}grid}\PY{p}{,} \PY{n}{n\PYZus{}jobs} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{n}{best\PYZus{}parameters} \PY{o}{=} \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{best\PYZus{}estimator\PYZus{}}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{n}{n\PYZus{}estimators} \PY{o}{=} \PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}estimators}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
          
          
         \PY{c+c1}{\PYZsh{} Decision Tree Classifier}
         \PY{k}{def} \PY{n+nf}{decision\PYZus{}tree\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{tree}\PY{o}{.}\PY{n}{DecisionTreeClassifier}\PY{p}{(}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
         
             \PY{n}{bagging} \PY{o}{=} \PY{n}{BaggingClassifier}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{max\PYZus{}samples}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{,} \PY{n}{max\PYZus{}features}\PY{o}{=}\PY{l+m+mi}{1} \PY{p}{)}
             \PY{n}{bagging}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{bagging}
          
          
         \PY{c+c1}{\PYZsh{} GBDT(Gradient Boosting Decision Tree) Classifier}
         \PY{k}{def} \PY{n+nf}{gradient\PYZus{}boosting\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{GradientBoostingClassifier}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{p}{)}
         
             \PY{n}{param\PYZus{}grid} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}estimators}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n+nb}{list}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,}\PY{l+m+mi}{300}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}\PY{p}{\PYZcb{}}
             \PY{n}{grid\PYZus{}search} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{param\PYZus{}grid}\PY{p}{,} \PY{n}{n\PYZus{}jobs} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{n}{best\PYZus{}parameters} \PY{o}{=} \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{best\PYZus{}estimator\PYZus{}}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{RandomForestClassifier}\PY{p}{(}\PY{n}{n\PYZus{}estimators} \PY{o}{=} \PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{n\PYZus{}estimators}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
         
         \PY{c+c1}{\PYZsh{} SVM Classifier}
         \PY{k}{def} \PY{n+nf}{svm\PYZus{}classifier}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{SVC}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{linear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
          
         \PY{c+c1}{\PYZsh{} SVM Classifier using cross validation}
         \PY{k}{def} \PY{n+nf}{svm\PYZus{}cross\PYZus{}validation}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}\PY{p}{:}
             \PY{n}{model} \PY{o}{=} \PY{n}{SVC}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{linear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
             \PY{n}{param\PYZus{}grid} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{l+m+mf}{1e\PYZhy{}3}\PY{p}{,} \PY{l+m+mf}{1e\PYZhy{}2}\PY{p}{,} \PY{l+m+mf}{1e\PYZhy{}1}\PY{p}{,} \PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{,} \PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{p}{[}\PY{l+m+mf}{0.001}\PY{p}{,} \PY{l+m+mf}{0.0001}\PY{p}{]}\PY{p}{\PYZcb{}}
             \PY{n}{grid\PYZus{}search} \PY{o}{=} \PY{n}{GridSearchCV}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{param\PYZus{}grid}\PY{p}{,} \PY{n}{n\PYZus{}jobs} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{n}{best\PYZus{}parameters} \PY{o}{=} \PY{n}{grid\PYZus{}search}\PY{o}{.}\PY{n}{best\PYZus{}estimator\PYZus{}}\PY{o}{.}\PY{n}{get\PYZus{}params}\PY{p}{(}\PY{p}{)}
             \PY{c+c1}{\PYZsh{}for para, val in best\PYZus{}parameters.items():}
                 \PY{c+c1}{\PYZsh{}print para, val}
             \PY{n}{model} \PY{o}{=} \PY{n}{SVC}\PY{p}{(}\PY{n}{kernel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{rbf}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{C}\PY{o}{=}\PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{C}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{gamma}\PY{o}{=}\PY{n}{best\PYZus{}parameters}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gamma}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{probability}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
             \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{train\PYZus{}x}\PY{p}{,} \PY{n}{train\PYZus{}y}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
         
         \PY{k}{def} \PY{n+nf}{feature\PYZus{}select}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{)}\PY{p}{:}
             \PY{n}{clf} \PY{o}{=} \PY{n}{ExtraTreesClassifier}\PY{p}{(}\PY{p}{)}
             \PY{n}{clf} \PY{o}{=} \PY{n}{clf}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}
             \PY{n}{model} \PY{o}{=} \PY{n}{SelectFromModel}\PY{p}{(}\PY{n}{clf}\PY{p}{,} \PY{n}{prefit}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
             \PY{k}{return} \PY{n}{model}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{c+c1}{\PYZsh{} just for my own record}
         
         
         \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} 
             \PY{n}{thresh} \PY{o}{=} \PY{l+m+mf}{0.5}    
         \PY{c+c1}{\PYZsh{}    model\PYZus{}save\PYZus{}file = \PYZdq{}/home/jason/datamining/model/models\PYZdq{}     }
         \PY{c+c1}{\PYZsh{}    model\PYZus{}save = \PYZob{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{}    result\PYZus{}save\PYZus{}file = \PYZsq{}/home/jason/datamining/result/results\PYZsq{} }
              
             \PY{n}{test\PYZus{}classifiers} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{KNN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DT}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GBC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}    
             \PY{n}{classifiers} \PY{o}{=} \PY{p}{\PYZob{}}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{KNN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{knn\PYZus{}classifier}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{logistic\PYZus{}regression\PYZus{}classifier}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{random\PYZus{}forest\PYZus{}classifier}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DT}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{decision\PYZus{}tree\PYZus{}classifier}\PY{p}{,}
                             \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GBC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{gradient\PYZus{}boosting\PYZus{}classifier}
             \PY{p}{\PYZcb{}}
                 
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{reading training and testing data...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}    
             \PY{c+c1}{\PYZsh{}X\PYZus{}train, X\PYZus{}validation, y\PYZus{}train, y\PYZus{}validation}
             \PY{n}{select\PYZus{}model} \PY{o}{=} \PY{n}{feature\PYZus{}select}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
             \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{select\PYZus{}model}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
             \PY{n}{X\PYZus{}validation} \PY{o}{=} \PY{n}{select\PYZus{}model}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{)}
         
             \PY{n}{result} \PY{o}{=} \PY{p}{[}\PY{p}{]}
                 
             \PY{k}{for} \PY{n}{classifier} \PY{o+ow}{in} \PY{n}{test\PYZus{}classifiers}\PY{p}{:}    
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{******************* }\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s1}{ ********************}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{n}{classifier}\PY{p}{)}    
                 \PY{n}{start\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}    
                 \PY{n}{model} \PY{o}{=} \PY{n}{classifiers}\PY{p}{[}\PY{n}{classifier}\PY{p}{]}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}   
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{training took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{s!}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)}\PY{p}{)}    
                 \PY{n}{predict} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{)}
         
                 \PY{n}{precision} \PY{o}{=} \PY{n}{metrics}\PY{o}{.}\PY{n}{precision\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}validation}\PY{p}{,} \PY{n}{predict}\PY{p}{)}    
                 \PY{n}{recall} \PY{o}{=} \PY{n}{metrics}\PY{o}{.}\PY{n}{recall\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}validation}\PY{p}{,} \PY{n}{predict}\PY{p}{)}    
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{precision: }\PY{l+s+si}{\PYZpc{}.2f}\PY{l+s+si}{\PYZpc{}\PYZpc{}}\PY{l+s+s1}{, recall: }\PY{l+s+si}{\PYZpc{}.2f}\PY{l+s+si}{\PYZpc{}\PYZpc{}}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{l+m+mi}{100} \PY{o}{*} \PY{n}{precision}\PY{p}{,} \PY{l+m+mi}{100} \PY{o}{*} \PY{n}{recall}\PY{p}{)}\PY{p}{)}    
                 \PY{n}{accuracy} \PY{o}{=} \PY{n}{metrics}\PY{o}{.}\PY{n}{accuracy\PYZus{}score}\PY{p}{(}\PY{n}{y\PYZus{}validation}\PY{p}{,} \PY{n}{predict}\PY{p}{)}    
                 \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy: }\PY{l+s+si}{\PYZpc{}.2f}\PY{l+s+si}{\PYZpc{}\PYZpc{}}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{l+m+mi}{100} \PY{o}{*} \PY{n}{accuracy}\PY{p}{)}\PY{p}{)}
         
                 \PY{n}{scores} \PY{o}{=} \PY{n}{cross\PYZus{}val\PYZus{}score}\PY{p}{(}\PY{n}{model}\PY{p}{,} \PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
                 \PY{n+nb}{print}\PY{p}{(}\PY{n}{scores}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
reading training and testing data{\ldots}
******************* KNN ********************
Fitting 3 folds for each of 20 candidates, totalling 60 fits

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[Parallel(n\_jobs=1)]: Done  60 out of  60 | elapsed:   16.6s finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
training took 16.900737s!
precision: 69.16\%, recall: 100.00\%
accuracy: 69.17\%
[0.6920215  0.69588588 0.69051065]
******************* LR ********************
training took 0.241711s!
precision: 77.36\%, recall: 90.43\%
accuracy: 75.09\%
[0.72219926 0.7366136  0.73433947]
******************* RF ********************
Fitting 3 folds for each of 20 candidates, totalling 60 fits

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[Parallel(n\_jobs=1)]: Done  60 out of  60 | elapsed:   19.7s finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
training took 21.534177s!
precision: 79.11\%, recall: 89.36\%
accuracy: 76.33\%
[0.73770153 0.7506719  0.74260906]
******************* DT ********************
training took 0.650436s!
precision: 71.19\%, recall: 92.07\%
accuracy: 68.75\%
[0.68561389 0.66694232 0.68658259]
******************* GBC ********************
Fitting 3 folds for each of 20 candidates, totalling 60 fits

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[Parallel(n\_jobs=1)]: Done  60 out of  60 | elapsed:  6.4min finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
training took 410.052062s!
precision: 79.57\%, recall: 90.35\%
accuracy: 77.29\%
[0.75010335 0.76431673 0.76121563]

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{n}{X\PYZus{}train}
         \PY{c+c1}{\PYZsh{}X\PYZus{}train, y\PYZus{}train = X,Y}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}14}]:} array([[ 0.      ,  1.      ,  0.      , {\ldots}, 11.774629, 11.737314,
                 11.739768],
                [ 0.      ,  0.      ,  0.      , {\ldots}, 11.737541, 12.21775 ,
                 11.256157],
                [ 1.      ,  0.      ,  0.      , {\ldots}, 11.562332, 11.451252,
                 11.531164],
                {\ldots},
                [ 0.      ,  0.      ,  1.      , {\ldots}, 11.248144, 11.919338,
                 12.642514],
                [ 0.      ,  1.      ,  0.      , {\ldots}, 11.222754, 11.798913,
                 11.439027],
                [ 0.      ,  1.      ,  0.      , {\ldots}, 11.568027, 11.701103,
                 11.861883]], dtype=float32)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{c+c1}{\PYZsh{}test cnn model}
         
         \PY{k+kn}{from} \PY{n+nn}{\PYZus{}\PYZus{}future\PYZus{}\PYZus{}} \PY{k}{import} \PY{n}{print\PYZus{}function}
         
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{preprocessing} \PY{k}{import} \PY{n}{sequence}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{Sequential}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{Dense}\PY{p}{,} \PY{n}{Dropout}\PY{p}{,} \PY{n}{Activation}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{Embedding}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{LSTM}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{Conv1D}\PY{p}{,} \PY{n}{MaxPooling1D}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{datasets} \PY{k}{import} \PY{n}{imdb}
         
         \PY{c+c1}{\PYZsh{} Embedding}
         \PY{n}{max\PYZus{}features} \PY{o}{=} \PY{l+m+mi}{15000}
         \PY{n}{maxlen} \PY{o}{=} \PY{l+m+mi}{270}
         \PY{n}{embedding\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{128}
         
         \PY{c+c1}{\PYZsh{} Convolution}
         \PY{n}{kernel\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{5}
         \PY{n}{filters} \PY{o}{=} \PY{l+m+mi}{64}
         \PY{n}{pool\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{3}
         
         \PY{c+c1}{\PYZsh{} LSTM}
         \PY{n}{lstm\PYZus{}output\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{70}
         
         \PY{c+c1}{\PYZsh{} Training}
         \PY{n}{batch\PYZus{}size} \PY{o}{=} \PY{l+m+mi}{30}
         \PY{n}{epochs} \PY{o}{=} \PY{l+m+mi}{5}
         
         \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         \PY{l+s+sd}{Note:}
         \PY{l+s+sd}{batch\PYZus{}size is highly sensitive.}
         \PY{l+s+sd}{Only 2 epochs are needed as the dataset is very small.}
         \PY{l+s+sd}{\PYZsq{}\PYZsq{}\PYZsq{}}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Loading data...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}X\PYZus{}train, X\PYZus{}validation, y\PYZus{}train, y\PYZus{}validation}
         \PY{c+c1}{\PYZsh{}(x\PYZus{}train, y\PYZus{}train), (x\PYZus{}test, y\PYZus{}test) = imdb.load\PYZus{}data(num\PYZus{}words=max\PYZus{}features)}
         
         \PY{c+c1}{\PYZsh{}X\PYZus{}train = np.asarray(np.abs(X))}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}\PY{p}{)}
         \PY{n}{X\PYZus{}validation} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{abs}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{train sequences}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{test sequences}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Pad sequences (samples x time)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{post}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{X\PYZus{}validation} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}validation}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{post}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}train shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{X\PYZus{}train}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x\PYZus{}test shape:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{X\PYZus{}validation}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
         
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Build model...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         \PY{n}{cnnmodel} \PY{o}{=} \PY{n}{Sequential}\PY{p}{(}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Embedding}\PY{p}{(}\PY{n}{max\PYZus{}features}\PY{p}{,} \PY{n}{embedding\PYZus{}size}\PY{p}{,}\PY{n}{input\PYZus{}length}\PY{o}{=}\PY{n}{maxlen}\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}model.add(Dense(32, activation=\PYZsq{}relu\PYZsq{}, input\PYZus{}dim=100))}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dropout}\PY{p}{(}\PY{l+m+mf}{0.5}\PY{p}{)}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Conv1D}\PY{p}{(}\PY{n}{filters}\PY{p}{,}
                          \PY{n}{kernel\PYZus{}size}\PY{p}{,}
                          \PY{n}{padding}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{valid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                          \PY{n}{strides}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{MaxPooling1D}\PY{p}{(}\PY{n}{pool\PYZus{}size}\PY{o}{=}\PY{n}{pool\PYZus{}size}\PY{p}{)}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{LSTM}\PY{p}{(}\PY{n}{lstm\PYZus{}output\PYZus{}size}\PY{p}{)}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Activation}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigmoid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{binary\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                       \PY{n}{optimizer}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adam}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                       \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Loading data{\ldots}
14512 train sequences
3629 test sequences
Pad sequences (samples x time)
x\_train shape: (14512, 270)
x\_test shape: (3629, 270)
Build model{\ldots}

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{18141}\PY{p}{]}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{18141}\PY{p}{:}\PY{p}{]}
         \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}score}\PY{o}{.}\PY{n}{score}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{k}{if} \PY{n+nv+vm}{\PYZus{}\PYZus{}name\PYZus{}\PYZus{}} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZus{}\PYZus{}main\PYZus{}\PYZus{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} 
             \PY{n}{thresh} \PY{o}{=} \PY{l+m+mf}{0.5}    
         \PY{c+c1}{\PYZsh{}    model\PYZus{}save\PYZus{}file = \PYZdq{}/home/jason/datamining/model/models\PYZdq{}     }
         \PY{c+c1}{\PYZsh{}    model\PYZus{}save = \PYZob{}\PYZcb{}}
         \PY{c+c1}{\PYZsh{}    result\PYZus{}save\PYZus{}file = \PYZsq{}/home/jason/datamining/result/results\PYZsq{} }
              
             \PY{n}{test\PYZus{}classifiers} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GBC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}    
             \PY{n}{classifiers} \PY{o}{=} \PY{p}{\PYZob{}}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{logistic\PYZus{}regression\PYZus{}classifier}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{random\PYZus{}forest\PYZus{}classifier}\PY{p}{,}
                            \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GBC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:}\PY{n}{gradient\PYZus{}boosting\PYZus{}classifier}
             \PY{p}{\PYZcb{}}
                 
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{reading training and testing data...}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}    
             \PY{c+c1}{\PYZsh{}X\PYZus{}train, X\PYZus{}validation, y\PYZus{}train, y\PYZus{}validation}
         \PY{c+c1}{\PYZsh{}    X\PYZus{}test = rearrange(Xt)}
         \PY{c+c1}{\PYZsh{}    X\PYZus{}test = Xt}
             \PY{n}{select\PYZus{}model} \PY{o}{=} \PY{n}{feature\PYZus{}select}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}
             \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{select\PYZus{}model}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
             \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{select\PYZus{}model}\PY{o}{.}\PY{n}{transform}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}
         
             \PY{n}{result} \PY{o}{=} \PY{p}{[}\PY{p}{]}
             
             \PY{n}{start\PYZus{}time} \PY{o}{=} \PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)}
             \PY{n}{model} \PY{o}{=} \PY{n}{classifiers}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}   
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{training took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{s!}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)}\PY{p}{)}    
             \PY{n}{Y\PYZus{}predict\PYZus{}lr} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{predict finished}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{classifiers}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RF}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}   
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{training took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{s!}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)}\PY{p}{)}    
             \PY{n}{Y\PYZus{}predict\PYZus{}rf} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{predict finished}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
             \PY{n}{model} \PY{o}{=} \PY{n}{classifiers}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GBC}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{)}   
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{training took }\PY{l+s+si}{\PYZpc{}f}\PY{l+s+s1}{s!}\PY{l+s+s1}{\PYZsq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{time}\PY{o}{.}\PY{n}{time}\PY{p}{(}\PY{p}{)} \PY{o}{\PYZhy{}} \PY{n}{start\PYZus{}time}\PY{p}{)}\PY{p}{)}    
             \PY{n}{Y\PYZus{}predict\PYZus{}gbc} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{predict\PYZus{}proba}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)}\PY{p}{[}\PY{p}{:}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{predict finished}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
             
                 
         \PY{c+c1}{\PYZsh{}    for classifier in test\PYZus{}classifiers:    }
         \PY{c+c1}{\PYZsh{}        print(\PYZsq{}******************* \PYZpc{}s ********************\PYZsq{} \PYZpc{} classifier)    }
         \PY{c+c1}{\PYZsh{}        start\PYZus{}time = time.time()    }
         \PY{c+c1}{\PYZsh{}        model = classifiers[classifier](X\PYZus{}train, y\PYZus{}train)   }
         \PY{c+c1}{\PYZsh{}        print(\PYZsq{}training took \PYZpc{}fs!\PYZsq{} \PYZpc{} (time.time() \PYZhy{} start\PYZus{}time))    }
         \PY{c+c1}{\PYZsh{}        Y\PYZus{}predict = model.predict\PYZus{}proba(X\PYZus{}test)[:,1]}
         \PY{c+c1}{\PYZsh{}        print(\PYZsq{}predict finished\PYZsq{})}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
reading training and testing data{\ldots}
training took 0.241209s!
predict finished
Fitting 3 folds for each of 20 candidates, totalling 60 fits

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[Parallel(n\_jobs=1)]: Done  60 out of  60 | elapsed:   25.5s finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
training took 27.739618s!
predict finished
Fitting 3 folds for each of 20 candidates, totalling 60 fits

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
[Parallel(n\_jobs=1)]: Done  60 out of  60 | elapsed:  8.2min finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
training took 546.078951s!
predict finished

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{c+c1}{\PYZsh{}cnn test}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{18141}\PY{p}{]}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{18141}\PY{p}{:}\PY{p}{]}
         \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}score}\PY{o}{.}\PY{n}{score}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{post}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{c+c1}{\PYZsh{}X\PYZus{}test = np.asarray(Xt)}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{sequence}\PY{o}{.}\PY{n}{pad\PYZus{}sequences}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{maxlen}\PY{o}{=}\PY{n}{maxlen}\PY{p}{,} \PY{n}{padding}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{post}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         
         
         \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{,} \PY{n}{y\PYZus{}train}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{128}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{5}\PY{p}{)}
         
         \PY{n}{Y\PYZus{}predict\PYZus{}cnn} \PY{o}{=} \PY{n}{cnnmodel}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{Y\PYZus{}predict\PYZus{}cnn} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{squeeze}\PY{p}{(}\PY{n}{Y\PYZus{}predict\PYZus{}cnn}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/5
18141/18141 [==============================] - 60s 3ms/step - loss: 0.5846 - acc: 0.6992
Epoch 2/5
18141/18141 [==============================] - 59s 3ms/step - loss: 0.5381 - acc: 0.7351
Epoch 3/5
18141/18141 [==============================] - 59s 3ms/step - loss: 0.5243 - acc: 0.7417
Epoch 4/5
18141/18141 [==============================] - 62s 3ms/step - loss: 0.5139 - acc: 0.7487
Epoch 5/5
18141/18141 [==============================] - 65s 4ms/step - loss: 0.5042 - acc: 0.7539

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{c+c1}{\PYZsh{}nn train}
         \PY{n}{X\PYZus{}train} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{18141}\PY{p}{]}
         \PY{n}{X\PYZus{}test} \PY{o}{=} \PY{n}{cleaned\PYZus{}train}\PY{p}{[}\PY{l+m+mi}{18141}\PY{p}{:}\PY{p}{]}
         \PY{n}{y\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}score}\PY{o}{.}\PY{n}{score}\PY{o}{.}\PY{n}{as\PYZus{}matrix}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{k+kc}{None}\PY{p}{)}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
         \PY{n}{X\PYZus{}array} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{X\PYZus{}train}\PY{p}{)}
         \PY{n}{Y\PYZus{}array} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{y\PYZus{}train}\PY{p}{)}
         \PY{n}{Xtest\PYZus{}array} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{asarray}\PY{p}{(}\PY{n}{X\PYZus{}test}\PY{p}{)} 
         \PY{k+kn}{import} \PY{n+nn}{warnings}
         \PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ignore}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}   
         \PY{c+c1}{\PYZsh{} Create your first MLP in Keras}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{models} \PY{k}{import} \PY{n}{Sequential}
         \PY{k+kn}{from} \PY{n+nn}{keras}\PY{n+nn}{.}\PY{n+nn}{layers} \PY{k}{import} \PY{n}{Dense}
         
         
         \PY{c+c1}{\PYZsh{} fix random seed for reproducibility}
         \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{seed}\PY{p}{(}\PY{l+m+mi}{7}\PY{p}{)}
         
         \PY{c+c1}{\PYZsh{} split into input (X) and output (Y) variables}
         \PY{n}{X} \PY{o}{=} \PY{n}{X\PYZus{}array}
         \PY{n}{Y} \PY{o}{=} \PY{n}{Y\PYZus{}array}
         \PY{c+c1}{\PYZsh{} create model}
         \PY{n}{nnmodel} \PY{o}{=} \PY{n}{Sequential}\PY{p}{(}\PY{p}{)}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{input\PYZus{}dim}\PY{o}{=}\PY{l+m+mi}{270}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{relu}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{add}\PY{p}{(}\PY{n}{Dense}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{activation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{sigmoid}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} Compile model}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{compile}\PY{p}{(}\PY{n}{loss}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{binary\PYZus{}crossentropy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{optimizer}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{adam}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{metrics}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{accuracy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} Fit the model}
         \PY{n}{nnmodel}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{,} \PY{n}{epochs}\PY{o}{=}\PY{l+m+mi}{25}\PY{p}{,} \PY{n}{batch\PYZus{}size}\PY{o}{=}\PY{l+m+mi}{150}\PY{p}{)}
         \PY{c+c1}{\PYZsh{} evaluate the model}
         \PY{n}{scores} \PY{o}{=} \PY{n}{nnmodel}\PY{o}{.}\PY{n}{evaluate}\PY{p}{(}\PY{n}{X}\PY{p}{,} \PY{n}{Y}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+si}{\PYZpc{}s}\PY{l+s+s2}{: }\PY{l+s+si}{\PYZpc{}.2f}\PY{l+s+si}{\PYZpc{}\PYZpc{}}\PY{l+s+s2}{\PYZdq{}} \PY{o}{\PYZpc{}} \PY{p}{(}\PY{n}{nnmodel}\PY{o}{.}\PY{n}{metrics\PYZus{}names}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,} \PY{n}{scores}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}\PY{p}{)}
         \PY{n}{Y\PYZus{}predict\PYZus{}nn} \PY{o}{=} \PY{n}{nnmodel}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{Xtest\PYZus{}array}\PY{p}{,} \PY{n}{verbose}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
         \PY{n}{Y\PYZus{}predict\PYZus{}nn} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{squeeze}\PY{p}{(}\PY{n}{Y\PYZus{}predict\PYZus{}nn}\PY{p}{,} \PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Epoch 1/25
18141/18141 [==============================] - 1s 59us/step - loss: 0.6737 - acc: 0.6873
Epoch 2/25
18141/18141 [==============================] - 0s 26us/step - loss: 0.5794 - acc: 0.7171
Epoch 3/25
18141/18141 [==============================] - 0s 22us/step - loss: 0.5597 - acc: 0.7253
Epoch 4/25
18141/18141 [==============================] - 0s 22us/step - loss: 0.5516 - acc: 0.7259
Epoch 5/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5565 - acc: 0.7264
Epoch 6/25
18141/18141 [==============================] - 0s 22us/step - loss: 0.5491 - acc: 0.7297
Epoch 7/25
18141/18141 [==============================] - 1s 29us/step - loss: 0.5310 - acc: 0.7361
Epoch 8/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5338 - acc: 0.7349
Epoch 9/25
18141/18141 [==============================] - 0s 26us/step - loss: 0.5247 - acc: 0.7377
Epoch 10/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5242 - acc: 0.7415
Epoch 11/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5275 - acc: 0.7386
Epoch 12/25
18141/18141 [==============================] - 1s 29us/step - loss: 0.5212 - acc: 0.7438
Epoch 13/25
18141/18141 [==============================] - 0s 24us/step - loss: 0.5219 - acc: 0.7452
Epoch 14/25
18141/18141 [==============================] - 0s 26us/step - loss: 0.5212 - acc: 0.7422
Epoch 15/25
18141/18141 [==============================] - 0s 22us/step - loss: 0.5218 - acc: 0.7409
Epoch 16/25
18141/18141 [==============================] - 0s 22us/step - loss: 0.5178 - acc: 0.7452
Epoch 17/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5130 - acc: 0.7465
Epoch 18/25
18141/18141 [==============================] - 1s 28us/step - loss: 0.5088 - acc: 0.7495
Epoch 19/25
18141/18141 [==============================] - 0s 27us/step - loss: 0.5174 - acc: 0.7449
Epoch 20/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5054 - acc: 0.7480
Epoch 21/25
18141/18141 [==============================] - 0s 23us/step - loss: 0.5094 - acc: 0.7462
Epoch 22/25
18141/18141 [==============================] - 0s 24us/step - loss: 0.5045 - acc: 0.7511
Epoch 23/25
18141/18141 [==============================] - 0s 25us/step - loss: 0.4998 - acc: 0.7534
Epoch 24/25
18141/18141 [==============================] - 0s 25us/step - loss: 0.5001 - acc: 0.7516
Epoch 25/25
18141/18141 [==============================] - 0s 25us/step - loss: 0.4994 - acc: 0.7551
18141/18141 [==============================] - 1s 28us/step

acc: 75.64\%

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{n}{Y\PYZus{}predict\PYZus{}nn}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}20}]:} array([0.8579925 , 0.94041866, 0.8313853 , {\ldots}, 0.70595163, 0.50523454,
                0.61891323], dtype=float32)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{n}{Y\PYZus{}predict\PYZus{}cnn}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}21}]:} array([0.8295582 , 0.78621113, 0.6645141 , {\ldots}, 0.64757854, 0.41389206,
                0.569912  ], dtype=float32)
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{Y\PYZus{}predict\PYZus{}lr}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}22}]:} array([0.73480094, 0.67819865, 0.68934352, {\ldots}, 0.62148617, 0.41585488,
                0.49107215])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{n}{Y\PYZus{}predict\PYZus{}rf}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}23}]:} array([0.77777778, 0.83333333, 0.61111111, {\ldots}, 0.66666667, 0.27777778,
                0.72222222])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{n}{Y\PYZus{}predict\PYZus{}gbc}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}24}]:} array([0.68636364, 0.79545455, 0.71818182, {\ldots}, 0.68636364, 0.52272727,
                0.58636364])
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{n}{Y\PYZus{}predict} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{Y\PYZus{}predict\PYZus{}rf}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{Y\PYZus{}predict}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(} \PY{n}{Y\PYZus{}predict\PYZus{}rf}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{n}{Y\PYZus{}predict\PYZus{}gbc}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{n}{Y\PYZus{}predict\PYZus{}cnn}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{n}{Y\PYZus{}predict\PYZus{}nn}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{l+m+mf}{4.0}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{n}{Y\PYZus{}predict}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}31}]:} [0.7879230195223683,
          0.8388544181079576,
          0.7062980920377404,
          0.943190951750736,
          0.768477741034344,
          0.7789613797508105,
          0.49860520630773875,
          0.7843875995790115,
          0.7212234910690423,
          0.7845466396122267,
          0.8631969074709247,
          0.3807709932026237,
          0.6003489641830174,
          0.40475087120677483,
          0.8834678248323575,
          0.2311255061265194,
          0.873183729010399,
          0.6564867117489227,
          0.8245094442307347,
          0.5769025559527705,
          0.9085451350970701,
          0.8365589516632485,
          0.8573541283005416,
          0.8478584218506862,
          0.9570992681113156,
          0.6973043681997242,
          0.7669518869633627,
          0.9678706323558635,
          0.8102602714239949,
          0.9404498155670937,
          0.8150021161394889,
          0.7075678125926943,
          0.8056072395558309,
          0.6466429714602653,
          0.720919211645319,
          0.45648324354128406,
          0.6798729751748268,
          0.9523854328827425,
          0.5096632492963714,
          0.8012050654852029,
          0.5585386865367793,
          0.8966844571961297,
          0.9577842205762863,
          0.6449160896166406,
          0.5598847478327125,
          0.8654995611821762,
          0.7667021310690678,
          0.31053749369551437,
          0.9412690380606988,
          0.6922423969314556,
          0.6682960966018715,
          0.8878353593927442,
          0.7403141237569577,
          0.5666097553390446,
          0.34242223821806184,
          0.5745137103579261,
          0.5056084916597665,
          0.8443176256887841,
          0.31077154433034887,
          0.652228018490955,
          0.7001406736747183,
          0.5219168139377026,
          0.40930632921782406,
          0.656459810562206,
          0.3910168477983186,
          0.9005869375936912,
          0.6207800335956342,
          0.8155419999300831,
          0.7215054362410247,
          0.674287120471097,
          0.4946316438792932,
          0.44189750848695486,
          0.38850753680624145,
          0.670125709790172,
          0.8459431837604503,
          0.456926736356032,
          0.649020043858374,
          0.6364261954119711,
          0.35317333382789534,
          0.49661802042915365,
          0.5756961399557614,
          0.3289054932768899,
          0.2922133699661553,
          0.5969380459099105,
          0.6982537371642662,
          0.6672041084880781,
          0.9109541324051944,
          0.38655630711353184,
          0.9205146239562468,
          0.7611620288605642,
          0.847835368550185,
          0.7250494646002548,
          0.6386729278347709,
          0.8814101485591946,
          0.9426997240143593,
          0.8593327081865735,
          0.8854973321009164,
          0.761613302670344,
          0.8395708713567618,
          0.7394665759320211,
          0.8789345564866307,
          0.9001224914584497,
          0.7608284189243509,
          0.890749600379154,
          0.8078777135020554,
          0.8980867635120044,
          0.6896643446852462,
          0.9010148370506788,
          0.5399896084359198,
          0.9436106944626028,
          0.7173233939240677,
          0.5830297254853778,
          0.910392844135111,
          0.840965419947499,
          0.7943909067698199,
          0.6443230259900141,
          0.2854903297592895,
          0.7789211454114529,
          0.5589566548063297,
          0.47925539472789475,
          0.7434961258461981,
          0.8142665823601714,
          0.6737935066524179,
          0.32949335013676173,
          0.7789133901848937,
          0.8469757748974693,
          0.8763380272520913,
          0.5939704627099663,
          0.534669560449894,
          0.8890788649970836,
          0.9061540941999416,
          0.8587573018639979,
          0.6894106894129455,
          0.42708793359272407,
          0.9092364098387535,
          0.7932932148979168,
          0.9141534354048546,
          0.8778116136488288,
          0.31902512615979317,
          0.5606782776689289,
          0.799687826181903,
          0.5312301490945046,
          0.8372125069300334,
          0.6845006552910564,
          0.7081792589389917,
          0.42824005556076467,
          0.8511270585084202,
          0.8249551722196617,
          0.8076245030068387,
          0.9575832835652611,
          0.8483461627755502,
          0.6348126131928329,
          0.4342086132728692,
          0.910660274432163,
          0.7441339467812066,
          0.5487191449813169,
          0.9428483106873252,
          0.6458503601828007,
          0.6478715577510872,
          0.6748445736037361,
          0.6227878210821537,
          0.47721030353897753,
          0.38173084201836827,
          0.5624694144936523,
          0.4064605542204597,
          0.42283884106260355,
          0.7142826438552201,
          0.25735870097773245,
          0.300363426979142,
          0.8148475043701403,
          0.7483688134737689,
          0.18327714607420592,
          0.187424812940034,
          0.5018928777238335,
          0.8774436646940732,
          0.7461095380060601,
          0.5821547227074402,
          0.7574544534237698,
          0.9182699016248337,
          0.4044226799348388,
          0.9030570583813118,
          0.9534332047809254,
          0.6053482233273862,
          0.8338723847059288,
          0.6746717732663107,
          0.4710536087101156,
          0.7165282924668958,
          0.5253831539792244,
          0.5434089610672961,
          0.5374659979584241,
          0.4923096076707647,
          0.9242050391556036,
          0.7847563390779977,
          0.9297017475270262,
          0.24365215433968437,
          0.8239973632675228,
          0.8743608000001521,
          0.7637416302254706,
          0.8781491487917273,
          0.5730877148834141,
          0.4451484339857342,
          0.8534584199238305,
          0.8504844195312924,
          0.9633799940347672,
          0.8727364252613048,
          0.5896017647752858,
          0.7880152231515056,
          0.7866893572638733,
          0.6372686437585138,
          0.557448315635474,
          0.5232809077308636,
          0.6768979428392468,
          0.41333027170463044,
          0.6733820088885047,
          0.3901863222471391,
          0.37588769712231374,
          0.6202792083073144,
          0.6115061372819574,
          0.9277016359146195,
          0.7874259028470878,
          0.5903055927970193,
          0.674875012612102,
          0.5501333484745989,
          0.8095936993757884,
          0.7760574921514048,
          0.8920446934724094,
          0.7165780002420599,
          0.7187719467613432,
          0.8814212735253151,
          0.5807313810845818,
          0.3672774839130315,
          0.3771320255717846,
          0.7178939505056902,
          0.23993113250518688,
          0.8084332549511785,
          0.6688980896665593,
          0.5472185995843676,
          0.4059818581649751,
          0.4196123341117242,
          0.48654953126955514,
          0.48960989256097814,
          0.8181980276348615,
          0.6550325908444145,
          0.4042796959178616,
          0.26801735141662636,
          0.32224028688864875,
          0.792819875689468,
          0.5036875356929471,
          0.41166821430728895,
          0.9129034184446239,
          0.6911988183103427,
          0.682110450574846,
          0.8094428915267039,
          0.7789399079903208,
          0.8764303402166174,
          0.8697151045907627,
          0.8709752200227795,
          0.8973718220236325,
          0.8913357615470886,
          0.7886683804519249,
          0.9222270407459953,
          0.3868860996281258,
          0.8841624048322139,
          0.93529912693934,
          0.7465166455567485,
          0.42523248632146854,
          0.9372259506974557,
          0.9483359392243202,
          0.8820688567077271,
          0.7292473619935489,
          0.7551258529376502,
          0.6753964922644875,
          0.866395427933847,
          0.9497094652869484,
          0.7964538020919067,
          0.9300987685268576,
          0.9003800843099151,
          0.4278203835391035,
          0.9267455072414995,
          0.47436560932735,
          0.8086494818781361,
          0.7873489572845325,
          0.8615791296116029,
          0.7466026792923609,
          0.689918143219418,
          0.6607753328602723,
          0.4456969882653217,
          0.749690659268938,
          0.7708888434099429,
          0.734322137934993,
          0.5580578808230583,
          0.7534403522207279,
          0.5241464212837845,
          0.8705191810022701,
          0.42413503350031495,
          0.35287840304651646,
          0.6580460749641813,
          0.7663515042777014,
          0.6625641684339504,
          0.5929596339211319,
          0.32459908910471985,
          0.889376096924146,
          0.9109267601762155,
          0.9192031358829652,
          0.8022899895304381,
          0.9361279361476802,
          0.7880824397007624,
          0.5849414509053182,
          0.8972358349898849,
          0.8594265683130784,
          0.8043501635091473,
          0.7545945063684926,
          0.9132316573099657,
          0.9459113776683807,
          0.4982894633454506,
          0.9029795646366446,
          0.8340057898350436,
          0.44305764192884617,
          0.8350959051137019,
          0.8564420763591323,
          0.8746259006285908,
          0.7906884379760184,
          0.8366959465874566,
          0.5337753916780154,
          0.8058989164203104,
          0.6716750606442943,
          0.809103346743969,
          0.8884953575904924,
          0.5002396085045555,
          0.7149070091319807,
          0.4350913967448051,
          0.8789101107554003,
          0.46671295701855364,
          0.597493737183436,
          0.7157944269252545,
          0.30779319616279216,
          0.31967834889738245,
          0.3729706623036452,
          0.32380542139513324,
          0.4057966457924458,
          0.4992691194168245,
          0.47575669637834184,
          0.5767367167906328,
          0.2931530572699778,
          0.8955279203677418,
          0.384741752986053,
          0.855808419621352,
          0.42032031480110055,
          0.9209269355643879,
          0.6788103330616999,
          0.47227998574574787,
          0.4001841742884029,
          0.5892985716462136,
          0.9187423077195582,
          0.6371719511169376,
          0.8178846693099147,
          0.7647785050399376,
          0.8042988872889316,
          0.757292119661967,
          0.888607545573302,
          0.8474724759658178,
          0.9578534979711879,
          0.4961389179783638,
          0.7548413442240821,
          0.4101055415892842,
          0.6277019953486895,
          0.5365940389157545,
          0.3704177319551959,
          0.5888153023792035,
          0.5242236738554156,
          0.9496873981422849,
          0.8443300134605831,
          0.6415797694463923,
          0.9593277966434306,
          0.6091647285403627,
          0.8655457016795572,
          0.7507855719689167,
          0.7546051210225231,
          0.7758263726728131,
          0.3751059223907163,
          0.3423158787416689,
          0.8653505594441385,
          0.7227092297992321,
          0.43182052370875773,
          0.8085773186852234,
          0.6896097604373489,
          0.6933330390188429,
          0.6969068336817953,
          0.3701540231855229,
          0.9184647465294058,
          0.13544006724700783,
          0.9093469715479648,
          0.5321388243424772,
          0.4576946802964114,
          0.727243339142414,
          0.4438348039232119,
          0.9637766320597042,
          0.9689246118068695,
          0.8169049958990078,
          0.919564668668641,
          0.20554686580794027,
          0.6648080778242361,
          0.5578568451633357,
          0.6442159159918024,
          0.4795824647551835,
          0.743976118980032,
          0.464428401655621,
          0.32222290223445554,
          0.7983155416719842,
          0.7495141196732569,
          0.49164667039206533,
          0.8083746325789076,
          0.7292885642762136,
          0.6584220804048306,
          0.3972718074917793,
          0.1028292984447696,
          0.05326840234073726,
          0.7955834566944777,
          0.7289211059760565,
          0.7083548713212061,
          0.8309462668919804,
          0.8010857508339063,
          0.9074121671493607,
          0.7328024386757552,
          0.7808678450608494,
          0.6055613092400811,
          0.8571539946276732,
          0.4696546486832879,
          0.28327577216456634,
          0.9422403510170754,
          0.7699714381586422,
          0.8715417295092285,
          0.9366658614440397,
          0.9321278364670397,
          0.6327915799437147,
          0.9014507049863989,
          0.6959251076585115,
          0.595489101202199,
          0.4356335046766984,
          0.8150362147225274,
          0.9268806893717159,
          0.3257427946636171,
          0.8197516848944655,
          0.7197908465609406,
          0.10365140590478074,
          0.8157847303633738,
          0.5447167629545385,
          0.558878982217625,
          0.9167099753413538,
          0.7278378998089319,
          0.7693455044067268,
          0.3853273902427067,
          0.734401288688785,
          0.7713853182816746,
          0.8355310353064778,
          0.9070854442890244,
          0.8348229946813198,
          0.6997885297043155,
          0.8324414808340747,
          0.6628010556252316,
          0.3103325757339145,
          0.7936818902841722,
          0.8793618994529802,
          0.4081586702152936,
          0.7434379329284032,
          0.20183814443422085,
          0.6864081867415496,
          0.9084792191031004,
          0.6237328369659607,
          0.7192723036414446,
          0.5657037662285747,
          0.5498628740960901,
          0.7007513774765862,
          0.6705296686502418,
          0.8905225707425011,
          0.8143293269354888,
          0.46385399267227967,
          0.8660266120024401,
          0.9071223375171122,
          0.9121611044864462,
          0.7801007724169529,
          0.8090312107945934,
          0.9398656336948125,
          0.9264702871291324,
          0.7470003828857884,
          0.849475904305776,
          0.8143595014858728,
          0.9029330836101012,
          0.9118548187041523,
          0.8930209364252861,
          0.8769379066698479,
          0.8485732344966946,
          0.4375465753102543,
          0.8197648066763926,
          0.9108869037844918,
          0.6449862662288878,
          0.9186910711755656,
          0.658431378849829,
          0.7887469777254144,
          0.7775346564223068,
          0.35678259522625894,
          0.42267902166855453,
          0.83986246649063,
          0.7070821835838184,
          0.894167574126311,
          0.5859400462622595,
          0.8905502291941884,
          0.33554185865202335,
          0.37886788098499025,
          0.3440730490016215,
          0.729179378621506,
          0.6898022575510873,
          0.2878511454345602,
          0.7443106286453478,
          0.2915862341571336,
          0.8045872831585431,
          0.35082990915486306,
          0.7108257103146929,
          0.6259022390902644,
          0.4495347396291868,
          0.741992192828294,
          0.6463522977901227,
          0.5807271829759232,
          0.6020084450642268,
          0.7261942840886838,
          0.5173846330004509,
          0.36835122415513705,
          0.7860754937535585,
          0.7891653306857505,
          0.6723196595004111,
          0.45558334614592366,
          0.9599750445647673,
          0.5629204741030028,
          0.9503787873670309,
          0.859867684768908,
          0.8321789311640191,
          0.9202518269269153,
          0.8649194291745773,
          0.7552853695069901,
          0.7954299054061523,
          0.8355315815017681,
          0.9473099441540361,
          0.7726764951992516,
          0.8898822652872163,
          0.6314235114388995,
          0.3838155296715823,
          0.5239775431276572,
          0.8985324497776802,
          0.8374498656903855,
          0.7955200344926179,
          0.7532314709039649,
          0.8690880518971067,
          0.8622094330161509,
          0.8181074752952113,
          0.8112900867305621,
          0.8614388316568702,
          0.38136518137021497,
          0.48709615276317403,
          0.5635666191878945,
          0.42303621169894634,
          0.6369227657715479,
          0.6419386001247348,
          0.24425826901287745,
          0.7132078319185913,
          0.8307586353836638,
          0.7492448065317039,
          0.6531701219503325,
          0.6608176450386192,
          0.49004978992120185,
          0.5269612772597208,
          0.5462466916050573,
          0.9082844938593682,
          0.6020829531731028,
          0.7255329367488321,
          0.7802642231035715,
          0.7156682534952357,
          0.6562530000251954,
          0.9009111145530084,
          0.9601631183515895,
          0.5610611627047712,
          0.9158598087050698,
          0.41309251372862343,
          0.4526897855930858,
          0.4782074906007208,
          0.43593470603227613,
          0.6557854638256208,
          0.30235017770619105,
          0.32731815435067574,
          0.38970013107314255,
          0.6547851233169286,
          0.5663105560974642,
          0.26096761526182444,
          0.6606358373706991,
          0.8017281283934912,
          0.47105137823206006,
          0.5252332033232006,
          0.3625335262128801,
          0.47551747136043776,
          0.45711930774980125,
          0.05902095386250453,
          0.787687869866689,
          0.3052899274485882,
          0.7819288205618811,
          0.38294206514503015,
          0.8429615298003862,
          0.7520125616078425,
          0.7890625485868166,
          0.5200500780584836,
          0.23488469391007616,
          0.8324995105314736,
          0.8896085299927778,
          0.858211874118959,
          0.8270981555033212,
          0.4496875521811572,
          0.9211600911737692,
          0.8220193033567582,
          0.78929760194186,
          0.5177481925999275,
          0.7844253030389247,
          0.8484801931212647,
          0.8001171421824079,
          0.41480516333772677,
          0.8618271171745627,
          0.854580536454615,
          0.8593842302910005,
          0.8247756405310197,
          0.9546056005087766,
          0.8031388124131194,
          0.9424343022433195,
          0.8511320826080111,
          0.827624569818227,
          0.7866125786244267,
          0.9148824332639425,
          0.7902558701809006,
          0.6598129751104297,
          0.7823420165163097,
          0.3218209906659945,
          0.3871970508134726,
          0.730774763045889,
          0.5063675195129231,
          0.7091709606575244,
          0.8933122584615091,
          0.8754273354706138,
          0.31748977554867963,
          0.7404434863064024,
          0.5334188088624164,
          0.564526966771092,
          0.7394960466358397,
          0.326452602551441,
          0.7236637247632248,
          0.5851711707283752,
          0.6229759257550191,
          0.8900834606452421,
          0.9314379628258522,
          0.8714868636143328,
          0.6038995921611786,
          0.8013794960999729,
          0.7845880152902218,
          0.40001558647914365,
          0.5621602526367313,
          0.8281177141148635,
          0.43678953333033455,
          0.7717404727983956,
          0.3562752952328836,
          0.4038624115815066,
          0.34944907285348337,
          0.5136231831077374,
          0.9200076937675477,
          0.9050677021645537,
          0.8558018631104267,
          0.9258658757113447,
          0.9111968085019275,
          0.8136884852792278,
          0.5506491722031073,
          0.7393131019792172,
          0.3964356944868059,
          0.9114408005066592,
          0.9214841476895592,
          0.7854384439160125,
          0.6253934148285124,
          0.9224556067977289,
          0.8777651586014815,
          0.936825275963003,
          0.7993254716348166,
          0.7260014947616693,
          0.6477493209369255,
          0.79232004673192,
          0.7647254532936848,
          0.9169420971111818,
          0.8550469211255661,
          0.864100040058897,
          0.792993063336671,
          0.8191558237328673,
          0.2435109046297242,
          0.7884945525665477,
          0.847916167131578,
          0.17336645784853685,
          0.8055338214443187,
          0.9100347671845946,
          0.8663167132271661,
          0.8811299311392236,
          0.7913085504914775,
          0.39716114316022755,
          0.3771075626515379,
          0.9341997802257538,
          0.6458960713461193,
          0.7908398753765857,
          0.6274451381931401,
          0.9022722799368579,
          0.8700531182867108,
          0.3597250626845793,
          0.7462744343461413,
          0.6671692872589284,
          0.5943291255620995,
          0.13912622679514114,
          0.3686602446617502,
          0.5297194616963166,
          0.8720610153494459,
          0.4793304104395587,
          0.7536379430029128,
          0.8493370020630384,
          0.9153751092727738,
          0.48565360783326506,
          0.935922782258554,
          0.9070489707017185,
          0.7644820706109807,
          0.4658168690975266,
          0.7927372709669248,
          0.9703926411542025,
          0.7349012274934787,
          0.4293954891387862,
          0.9176871607098916,
          0.5404468921549392,
          0.9656298734925011,
          0.5396649338831805,
          0.6040047725643775,
          0.44933132660208325,
          0.527478818098704,
          0.6002599843975269,
          0.6500359291380102,
          0.8344554177137337,
          0.8135585780095572,
          0.9083320323565993,
          0.803929597350082,
          0.8585041982055914,
          0.8743599624344797,
          0.6980289100697546,
          0.7136686215497027,
          0.6902662993079485,
          0.5050955508995538,
          0.8792023096120719,
          0.7476489152872201,
          0.9401367968983121,
          0.7270474076873124,
          0.9757437099109997,
          0.5213362146206577,
          0.6655629533709901,
          0.5157555628906597,
          0.8286846267454552,
          0.6608413184230978,
          0.8418127854966154,
          0.33477355467550685,
          0.4960052791568968,
          0.3419775910901301,
          0.2896699372415591,
          0.3562328591190203,
          0.48902776903576317,
          0.7169425722324487,
          0.8259694466085146,
          0.5589403622379207,
          0.9461627973751588,
          0.5835951017309922,
          0.589495322424354,
          0.33038517508392384,
          0.4673619196571485,
          0.850788276544725,
          0.6934460300688792,
          0.4858258688841203,
          0.7777762259497787,
          0.976058808781884,
          0.9675060776146975,
          0.9027483421142655,
          0.599894448572939,
          0.7160207851968631,
          0.44587824385274544,
          0.8329481082432197,
          0.9242391085082835,
          0.7562096073771968,
          0.6336719548762446,
          0.7749986921597009,
          0.9167070532386953,
          0.8129135453941846,
          0.8702816483348307,
          0.10495512248440222,
          0.033144038322974335,
          0.5834954345768149,
          0.7578388076538991,
          0.893047513835358,
          0.7188508684888031,
          0.9511283324523405,
          0.4256792176552493,
          0.271090364584116,
          0.44630487637989447,
          0.7574264776827109,
          0.6591650060180462,
          0.7372200908684972,
          0.9177856813777576,
          0.2656013273003728,
          0.7537123854413177,
          0.6406325691276127,
          0.6621558812531558,
          0.8076169346920168,
          0.30865597390767296,
          0.842190174863796,
          0.778767822336669,
          0.273904467298828,
          0.7715323046602384,
          0.8602748858507233,
          0.726620542130085,
          0.6108839739753742,
          0.7364188602777443,
          0.6916003118259738,
          0.863901778513735,
          0.8597175928378346,
          0.8432592916067201,
          0.501890183714303,
          0.21940075374688162,
          0.3287073458234469,
          0.9025375494451234,
          0.9228275938467546,
          0.6783093330384504,
          0.7730840746200446,
          0.736280726242547,
          0.7294487932414719,
          0.5917655890337145,
          0.916839751842046,
          0.4268235251608521,
          0.21054683601615404,
          0.42905028406718765,
          0.6716274393327308,
          0.7520833444113684,
          0.5900950534777207,
          0.520497067558645,
          0.6018791823525622,
          0.44106063686235986,
          0.7724467981343317,
          0.5778893949106486,
          0.44469946661982873,
          0.5417783844651598,
          0.9042863611320052,
          0.26785599322180553,
          0.748206107243143,
          0.4480677302437599,
          0.31609608740216555,
          0.8160831307521974,
          0.9181353016032112,
          0.12824774717893261,
          0.8549439351366024,
          0.629485568855748,
          0.5954501293674864,
          0.8088600411559597,
          0.8499969636551057,
          0.9267046536761101,
          0.5099593178641917,
          0.8970545065222364,
          0.8929224230725356,
          0.8085074072233354,
          0.5513218885419344,
          0.48961812626532836,
          0.6030695152854679,
          0.649836534984184,
          0.8866916691414033,
          0.8468568741974204,
          0.7661621690398515,
          0.7346226676545962,
          0.3825571549397827,
          0.4901130429873563,
          0.43762050022681553,
          0.5322285868302741,
          0.651788144521039,
          0.8478331111597293,
          0.6329213119516469,
          0.6350479079015328,
          0.7124549667040507,
          0.8463533117915645,
          0.539778175965102,
          0.4338415113362399,
          0.618502124105439,
          0.44856004728512333,
          0.09647370129823685,
          0.4791076360025791,
          0.7272516473074152,
          0.5179096732928296,
          0.8310377510509106,
          0.8222080749393713,
          0.4570708885487884,
          0.9518342633139003,
          0.8716532677412033,
          0.4343061544527911,
          0.6532043250221194,
          0.5621861278709739,
          0.7148254750503433,
          0.7891695371480903,
          0.9193875507874922,
          0.35620876559705444,
          0.8274226472835348,
          0.5733025091766106,
          0.5985998908979724,
          0.8921740058696631,
          0.8444695000997697,
          0.5334795136192833,
          0.4432387126666127,
          0.547464120674013,
          0.8537881079045209,
          0.7934244191706783,
          0.41874417483505577,
          0.5908398338791095,
          0.9263035312144443,
          0.898107785498253,
          0.6112812922458456,
          0.9010241892903742,
          0.8553693280978636,
          0.8964370949400795,
          0.185333118836085,
          0.534944370840535,
          0.6686003845448446,
          0.5835403515533968,
          0.6973734078985272,
          0.6942390414199444,
          0.7148904488243237,
          0.8220461128336011,
          0.7831209435306414,
          0.7586249789505294,
          0.9199771710417488,
          0.6223448736198021,
          0.5099099472165107,
          0.8874459596896412,
          0.962796746600758,
          0.3573729398124146,
          0.387807725896739,
          0.6822845463499878,
          0.8120342117668402,
          0.6132718926126307,
          0.5349965954669799,
          0.6653914597299364,
          0.2882020725520572,
          0.7743458351703605,
          0.7350094733515171,
          0.6838421782760908,
          0.7569975134700235,
          0.4411341812273469,
          0.7142410216909466,
          0.6375649080131993,
          0.6912523763348357,
          0.36259249076247213,
          0.6160562602257488,
          0.43535042019805525,
          0.6808919955985715,
          0.7052298425725012,
          0.6327057378159628,
          0.7820889674051843,
          0.45044085926780797,
          0.6856062317285875,
          0.5227355614455059,
          0.7840680001058964,
          0.7814689537792494,
          0.8521055931093717,
          0.8143975616404504,
          0.8166510367634321,
          0.5592338114374815,
          0.8636048674583435,
          0.46555604450028354,
          0.8021451380818782,
          0.5838297293041692,
          0.9007595030948369,
          0.751490477088726,
          0.9144833569875871,
          0.5356153687142362,
          0.8782710076582552,
          0.3201451778110832,
          0.8058657756357481,
          0.6573308645775824,
          0.7995697505245305,
          0.9229980880262876,
          0.9121274190719681,
          0.8425156342561799,
          0.8987830066921735,
          0.4438310125861505,
          0.8963282037865032,
          0.7028695393993397,
          0.867933125929399,
          0.7304127310562616,
          0.578213436404864,
          0.3260228379733032,
          0.8932427215154725,
          0.9148329760390099,
          0.5005388915839821,
          0.8016761651544859,
          0.8241777198483246,
          0.8153525488846229,
          {\ldots}]
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}37}]:} \PY{n}{Y\PYZus{}predict\PYZus{}temp} \PY{o}{=} \PY{p}{[}\PY{p}{]}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{Y\PYZus{}predict\PYZus{}rf}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{Y\PYZus{}predict\PYZus{}temp}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{p}{(}\PY{n}{Y\PYZus{}predict\PYZus{}rf}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{n}{Y\PYZus{}predict\PYZus{}gbc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{/} \PY{l+m+mf}{2.0}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}40}]:} \PY{n}{Y\PYZus{}predict\PYZus{}temp} 
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}35}]:} \PY{n}{temp\PYZus{}score} \PY{o}{=} \PY{n}{load\PYZus{}label}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{submission.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{submit\PYZus{}score}  \PY{o}{=} \PY{n}{temp\PYZus{}score}
         \PY{n}{submit\PYZus{}score}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Y\PYZus{}predict}
         \PY{n}{submit\PYZus{}score}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{predict\PYZus{}result\PYZus{}cnn.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}41}]:} \PY{n}{temp\PYZus{}score} \PY{o}{=} \PY{n}{load\PYZus{}label}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{submission.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{submit\PYZus{}score}  \PY{o}{=} \PY{n}{temp\PYZus{}score}
         \PY{n}{submit\PYZus{}score}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{score}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{Y\PYZus{}predict\PYZus{}temp}
         \PY{n}{submit\PYZus{}score}\PY{o}{.}\PY{n}{to\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{predict\PYZus{}result\PYZus{}ncnn.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor} }]:} \PY{n}{table} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{pivot\PYZus{}table}\PY{p}{(}\PY{n}{train\PYZus{}file}\PY{p}{,}\PY{n}{values} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lvl3}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{type}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{aggfunc}\PY{o}{=}\PY{p}{[}\PY{n+nb}{min}\PY{p}{,} \PY{n+nb}{max}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{]}\PY{p}{)}
        \PY{n}{table}
\end{Verbatim}



    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
